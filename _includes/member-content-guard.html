{% comment %}
ä¼šå‘˜å†…å®¹è®¿é—®æ§åˆ¶
ä½¿ç”¨æ–¹æ³•: {% include member-content-guard.html tier="monthly" %}
{% endcomment %}

{% if page.member_tier and page.member_tier != 'free' %}
<div class="member-content-guard" data-tier="{{ page.member_tier }}">
  <div class="notice--warning">
    <h4><i class="fas fa-lock"></i> ä¼šå‘˜ä¸“äº«å†…å®¹</h4>
    <p>æ­¤å†…å®¹éœ€è¦ 
      {% case page.member_tier %}
        {% when 'experience' %}ä½“éªŒä¼šå‘˜ (VIP1)
        {% when 'monthly' %}æœˆåº¦ä¼šå‘˜ (VIP2) 
        {% when 'quarterly' %}å­£åº¦ä¼šå‘˜ (VIP3)
        {% when 'yearly' %}å¹´åº¦ä¼šå‘˜ (VIP4)
      {% endcase %}
      åŠä»¥ä¸Šæƒé™æ‰èƒ½æŸ¥çœ‹ã€‚
    </p>
    {% unless page.layout contains 'members' %}
    <p>
      <a href="{{ '/members/' | relative_url }}" class="btn btn--primary">
        <i class="fas fa-key"></i> å‰å¾€ä¼šå‘˜ä¸“åŒº
      </a>
      <a href="{{ '/member-signup/' | relative_url }}" class="btn btn--info">
        <i class="fas fa-user-plus"></i> åŠ å…¥ä¼šå‘˜
      </a>
    </p>
    {% endunless %}
  </div>
</div>

<script>
// æ£€æŸ¥ä¼šå‘˜è®¿é—®æƒé™ï¼ˆæ”¯æŒç®¡ç†å‘˜è®¿é—®ç ï¼‰
(function() {
  const pageRequiredTier = '{{ page.member_tier }}';
  const memberLevel = localStorage.getItem('memberLevel');
  const memberExpiry = localStorage.getItem('memberExpiry');
  
  // ä¼šå‘˜ç­‰çº§æƒé‡æ˜ å°„
  const tierWeight = {
    'experience': 1,
    'monthly': 2,
    'quarterly': 3,
    'yearly': 4,
    'admin': 999  // ç®¡ç†å‘˜æœ€é«˜æƒé™
  };
  
  // æ£€æŸ¥æ˜¯å¦æœ‰æ•ˆä¼šå‘˜
  if (memberLevel && memberExpiry) {
    const expiryDate = new Date(memberExpiry);
    const now = new Date();
    
    if (expiryDate > now) {
      // æ£€æŸ¥ç­‰çº§æƒé™
      const userWeight = tierWeight[memberLevel] || 0;
      const requiredWeight = tierWeight[pageRequiredTier] || 0;
      
      if (userWeight >= requiredWeight) {
        // æƒé™è¶³å¤Ÿï¼Œéšè—é™åˆ¶æç¤º
        const memberGuard = document.querySelector('.member-content-guard');
        if (memberGuard) {
          memberGuard.style.display = 'none';
        }
        
        // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ·»åŠ ç®¡ç†å‘˜æ ‡è¯†
        if (memberLevel === 'admin') {
          addAdminBadge();
        }
        return;
      }
    }
  }
  
  // æƒé™ä¸è¶³ï¼Œæ˜¾ç¤ºé™åˆ¶æç¤º
  const memberGuard = document.querySelector('.member-content-guard');
  if (memberGuard) {
    memberGuard.style.display = 'block';
  }
})();

// æ·»åŠ ç®¡ç†å‘˜æ ‡è¯†
function addAdminBadge() {
  // é¿å…é‡å¤æ·»åŠ 
  if (document.querySelector('.admin-badge')) return;
  
  const badge = document.createElement('div');
  badge.className = 'admin-badge';
  badge.innerHTML = 'ğŸ”§ ç®¡ç†å‘˜æ¨¡å¼';
  badge.style.cssText = `
    position: fixed;
    top: 10px;
    right: 10px;
    background: linear-gradient(135deg, #dc3545, #c82333);
    color: white;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 12px;
    font-weight: bold;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(220,53,69,0.3);
  `;
  document.body.appendChild(badge);
}
</script>
{% endif %}