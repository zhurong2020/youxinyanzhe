# run.py æ–°æ—§ç‰ˆæœ¬è¿ç§»é—®é¢˜è®°å½•

**è®°å½•æ—¥æœŸ**: 2025-08-16  
**åˆ†æå¯¹è±¡**: run.py (243è¡Œ) vs run_old.py (3394è¡Œ)  
**çŠ¶æ€**: ğŸ”„ éœ€è¦ä¿®å¤å’ŒåŠŸèƒ½è¡¥å…¨

## ğŸ¯ å…³é”®å‘ç°æ€»ç»“

### 1. æ¶æ„å˜åŒ–
- **æ–°run.py**: åˆ†å±‚æ¶æ„ - MenuHandler â†’ MenuRouter â†’ ä¸“é—¨å¤„ç†å™¨
- **æ—§run_old.py**: å•æ–‡ä»¶åŒ…å«æ‰€æœ‰åŠŸèƒ½å®ç°
- **è¿ç§»æ•ˆæœ**: ä»£ç ç»„ç»‡æ›´æ¸…æ™°ï¼Œä½†å¯èƒ½ä¸¢å¤±éƒ¨åˆ†åŠŸèƒ½

### 2. èœå•è·¯å¾„æ˜¾ç¤ºé—®é¢˜ âš ï¸ ç«‹å³ä¿®å¤
**é—®é¢˜æè¿°**: å­èœå•æœªæ˜¾ç¤º1.1æ ¼å¼çš„é¢åŒ…å±‘è·¯å¾„
**æŠ€æœ¯åŸå› **: 
- BaseMenuHandleræœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š`create_menu_loop()` å’Œ `create_menu_loop_with_path()`
- å½“å‰å­èœå•ä½¿ç”¨ä¸å¸¦è·¯å¾„çš„ç‰ˆæœ¬
- `push_menu_path()` å’Œ `pop_menu_path()` æœºåˆ¶å­˜åœ¨ä½†æœªåœ¨å­èœå•ä¸­æ­£ç¡®ä½¿ç”¨

**è§£å†³æ–¹æ¡ˆ**:
1. æ›´æ–°å­èœå•ä½¿ç”¨ `create_menu_loop_with_path()`
2. ç¡®ä¿æ¯ä¸ªå­èœå•æ­£ç¡®ä¼ é€’menu_idå‚æ•°
3. åœ¨display_menu_headerè°ƒç”¨ä¸­ä¼ é€’menu_id

### 3. ç¼ºå¤±åŠŸèƒ½æ¸…å• âŒ éœ€è¦è¡¥å…¨

#### é«˜ä¼˜å…ˆçº§ç¼ºå¤±åŠŸèƒ½:
1. **å›¾ç‰‡ç´¢å¼•ç®¡ç†** (`handle_image_index_menu`)
   - ä½ç½®: run_old.py:2218
   - åŠŸèƒ½: å›¾ç‰‡ç»Ÿè®¡ã€æŠ¥å‘Šç”Ÿæˆã€æŒ‰æ–‡ç« /æ—¥æœŸæŸ¥çœ‹ã€æ¸…ç†æ— æ•ˆè®°å½•

2. **æ··åˆå›¾ç‰‡ç®¡ç†** (`handle_mixed_image_management_menu`)  
   - ä½ç½®: run_old.py:2332
   - åŠŸèƒ½: å®Œæ•´çš„å›¾ç‰‡å‘ç°å’Œå¤„ç†æµç¨‹

3. **OneDriveæ¸…ç†å·¥å…·** (`handle_onedrive_cleanup_menu`)
   - ä½ç½®: run_old.py:2827  
   - åŠŸèƒ½: OneDriveå›¾ç‰‡æ¸…ç†å’Œç»´æŠ¤

#### ä¸­ä¼˜å…ˆçº§ç¼ºå¤±åŠŸèƒ½:
4. **å¤„ç†ä¼šè¯ç®¡ç†** (`handle_processing_sessions_menu`)
   - ä½ç½®: run_old.py:2500
   - åŠŸèƒ½: æ‰¹å¤„ç†ä¼šè¯è·Ÿè¸ª

5. **YouTube OAuthèœå•** (`handle_youtube_oauth_menu`) 
   - ä½ç½®: run_old.py:3135
   - åŠŸèƒ½: OAuthè®¤è¯ç®¡ç†

6. **è°ƒè¯•èœå•** (`handle_debug_menu`)
   - ä½ç½®: run_old.py:1207
   - åŠŸèƒ½: ç³»ç»Ÿè°ƒè¯•å’Œç»´æŠ¤å·¥å…·

#### ä½ä¼˜å…ˆçº§åŠŸèƒ½:
7. **VIPå†…å®¹åˆ›ä½œèœå•é›†æˆ**: VIPMenuHandlerå­˜åœ¨ä½†å¯èƒ½æœªå®Œå…¨é›†æˆåˆ°ä¸»èœå•

### 4. åŠŸèƒ½è¿ç§»çŠ¶æ€

#### âœ… å·²æˆåŠŸè¿ç§»:
- 9ä¸ªä¸»èœå•é€‰é¡¹ç»“æ„
- åŸºç¡€è·¯ç”±æœºåˆ¶  
- æ ¸å¿ƒå†…å®¹å¤„ç†åŠŸèƒ½
- ContentPipelineç»Ÿä¸€æ¥å£

#### âš ï¸ éƒ¨åˆ†è¿ç§»/éœ€éªŒè¯:
- å­èœå•åŠŸèƒ½å®Œæ•´æ€§
- è·¯å¾„æ˜¾ç¤ºæœºåˆ¶
- ä¸“é—¨å·¥å…·èœå•çš„é›†æˆåº¦

#### âŒ æ˜ç¡®ç¼ºå¤±:
- è§ä¸Šè¿°ç¼ºå¤±åŠŸèƒ½æ¸…å•

## ğŸ”§ ä¿®å¤è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µ - ç«‹å³ä¿®å¤ (å½“å‰)
1. **ä¿®å¤èœå•è·¯å¾„æ˜¾ç¤ºé—®é¢˜**
   - æ›´æ–°å­èœå•ä½¿ç”¨å¸¦è·¯å¾„ç‰ˆæœ¬çš„create_menu_loop
   - ç¡®ä¿1.1æ ¼å¼è·¯å¾„æ­£ç¡®æ˜¾ç¤º

### ç¬¬äºŒé˜¶æ®µ - åŠŸèƒ½éªŒè¯
2. **é€šè¿‡åšæ–‡åˆ›ä½œæµ‹è¯•æ¯ä¸ªåŠŸèƒ½**
   - éªŒè¯9ä¸ªä¸»èœå•çš„å®é™…å¯ç”¨æ€§
   - è¯†åˆ«è¿è¡Œæ—¶é”™è¯¯å’Œç¼ºå¤±åŠŸèƒ½

### ç¬¬ä¸‰é˜¶æ®µ - åŠŸèƒ½è¡¥å…¨  
3. **è¡¥å……å…³é”®ç¼ºå¤±åŠŸèƒ½**
   - ä¼˜å…ˆè¡¥å……å›¾ç‰‡ç®¡ç†ç›¸å…³åŠŸèƒ½
   - é›†æˆOneDriveæ¸…ç†å·¥å…·
   - æ·»åŠ è°ƒè¯•å’Œç»´æŠ¤å·¥å…·

### ç¬¬å››é˜¶æ®µ - å®Œå–„ä¼˜åŒ–
4. **æ–‡æ¡£æ›´æ–°å’Œæœ€ç»ˆéªŒè¯**
   - æ›´æ–°ç”¨æˆ·æŒ‡å—
   - å®Œæ•´åŠŸèƒ½æµ‹è¯•
   - æ€§èƒ½å’Œç¨³å®šæ€§éªŒè¯

## ğŸ“ æŠ€æœ¯ç»†èŠ‚å¤‡æ³¨

### èœå•è·¯å¾„æœºåˆ¶:
```python
# BaseMenuHandlerä¸­çš„å…³é”®æ–¹æ³•:
def push_menu_path(self, menu_id: str, menu_name: str)  # æ·»åŠ è·¯å¾„
def pop_menu_path(self)  # ç§»é™¤è·¯å¾„  
def get_breadcrumb(self) -> str  # è·å–è·¯å¾„å­—ç¬¦ä¸²
def create_menu_loop_with_path(...)  # å¸¦è·¯å¾„çš„èœå•å¾ªç¯
```

### ç¼ºå¤±åŠŸèƒ½ä»£ç ä½ç½®:
- å›¾ç‰‡ç´¢å¼•: `scripts/tools/onedrive_image_index.py`
- æ··åˆå›¾ç‰‡ç®¡ç†: `scripts/tools/mixed_image_manager.py`  
- OneDriveæ¸…ç†: `scripts/tools/cleanup_onedrive_*.py`

---
**ä¸‹ä¸€æ­¥**: ç«‹å³å¼€å§‹ä¿®å¤èœå•è·¯å¾„æ˜¾ç¤ºé—®é¢˜