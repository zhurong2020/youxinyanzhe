# OneDriveå›¾ç‰‡ç®¡ç†å·¥ä½œæµç¨‹

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜åšå®¢å›¾ç‰‡ä»åˆ›ä½œåˆ°å‘å¸ƒçš„å®Œæ•´è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹ã€‚

## âš ï¸ é‡è¦æ›´æ–° (2025-08-14)

### OneDriveå›¾ç‰‡é“¾æ¥æ ¼å¼ä¼˜åŒ– ğŸ”§
- âœ… **ä¿®å¤å›¾ç‰‡æ˜¾ç¤ºé—®é¢˜** - è½¬æ¢ä¸ºSharePointç›´æ¥ä¸‹è½½é“¾æ¥æ ¼å¼
- âœ… **æœ€ä½³å®è·µç¡®ç«‹** - ä½¿ç”¨`_layouts/15/download.aspx?share=TOKEN`æ ¼å¼
- âœ… **ä¼ä¸šè´¦æˆ·ä¼˜åŒ–** - ä¸“é—¨é€‚é…ä¼ä¸šMicrosoft 365è´¦æˆ·é™åˆ¶
- âœ… **é•¿æœŸç¨³å®šæ€§** - é€‰æ‹©æ°¸ä¹…æœ‰æ•ˆä¸”å¯ç›´æ¥åµŒå…¥çš„é“¾æ¥æ ¼å¼

### å›¾ç‰‡é“¾æ¥æ ¼å¼è¯´æ˜
```
âŒ ä¹‹å‰ä½¿ç”¨: https://domain/:i:/g/personal/user/TOKEN (é¢„è§ˆé“¾æ¥ï¼Œéœ€è®¤è¯)
âœ… ç°åœ¨ä½¿ç”¨: https://domain/personal/user/_layouts/15/download.aspx?share=TOKEN (ç›´æ¥ä¸‹è½½)

ä¼˜åŠ¿:
- å¯ç›´æ¥åµŒå…¥<img>æ ‡ç­¾
- æ— éœ€ç”¨æˆ·è®¤è¯
- é•¿æœŸç¨³å®šæœ‰æ•ˆ  
- é€‚åˆåšå®¢å›¾ç‰‡å±•ç¤º
```

### ä¼ä¸šè´¦æˆ·é€‚é…ä¼˜åŒ–
- âœ… **ä¼ä¸šè´¦æˆ·å…¼å®¹æ€§** - ä¼˜åŒ–ä¸ºä¼ä¸šMicrosoft 365è´¦æˆ·çš„SharePointç›´æ¥ä¸‹è½½æ¨¡å¼
- âœ… **é¿å…embedæ¨¡å¼** - ä¼ä¸šè´¦æˆ·ä¸æ”¯æŒembed+anonymousï¼Œä½¿ç”¨ç›´æ¥ä¸‹è½½æ›¿ä»£
- âœ… **æ™ºèƒ½é“¾æ¥ç”Ÿæˆ** - è‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆåšå®¢å±•ç¤ºçš„é“¾æ¥æ ¼å¼

### æ–°å¢åŠŸèƒ½ (2025-08-11)
- âœ… **ä¿®å¤å›¾ç‰‡æ¸²æŸ“é—®é¢˜** - OneDriveé“¾æ¥ç°åœ¨ç”Ÿæˆå¯ç›´æ¥åµŒå…¥Jekyllçš„å›¾ç‰‡URL
- âœ… **å¢åŠ å›é€€æœºåˆ¶** - å¤„ç†å¤±è´¥æ—¶è‡ªåŠ¨æ¢å¤åˆ°åŸå§‹çŠ¶æ€  
- âœ… **é›†æˆGitHubå¤‡ä»½** - å®Œæ•´çš„æ–‡ç« å’Œå›¾ç‰‡èµ„æºå¤‡ä»½åˆ°GitHub Release
- âœ… **é“¾æ¥éªŒè¯åŠŸèƒ½** - è‡ªåŠ¨æµ‹è¯•å›¾ç‰‡é“¾æ¥å¯è®¿é—®æ€§

### æ–°å¢å·¥å…·
- `enhanced_onedrive_processor.py` - å¢å¼ºå¤„ç†å™¨(åŒ…å«å›é€€+å¤‡ä»½)
- `restore_local_image_links.py` - OneDriveé“¾æ¥æ¢å¤ä¸ºæœ¬åœ°é“¾æ¥
- `cleanup_onedrive_images.py` - å®‰å…¨æ¸…ç†OneDriveæ–‡ä»¶å’Œè®°å½•

## ğŸ“‹ OneDriveå›¾ç‰‡é“¾æ¥æœ€ä½³å®è·µ

### URLæ ¼å¼å¯¹æ¯”åˆ†æ

#### 1. SharePointç›´æ¥ä¸‹è½½é“¾æ¥ âœ… æ¨è
**æ ¼å¼**: `https://domain/personal/user/_layouts/15/download.aspx?share=TOKEN`

**ç‰¹ç‚¹**:
- âœ… å¯ç›´æ¥åµŒå…¥`<img>`æ ‡ç­¾
- âœ… ç†è®ºä¸Šæ°¸ä¹…æœ‰æ•ˆ
- âœ… é€‚åˆä¼ä¸šMicrosoft 365è´¦æˆ·
- âš ï¸ ä¾èµ–SharePointæœåŠ¡å¯ç”¨æ€§

#### 2. view+anonymousåˆ†äº«é“¾æ¥ âŒ ä¸æ¨è
**æ ¼å¼**: `https://domain/:i:/g/personal/user/TOKEN`

**ç‰¹ç‚¹**:
- âœ… æ°¸ä¹…æœ‰æ•ˆï¼Œä¸ä¼šè¿‡æœŸ
- âŒ æŒ‡å‘é¢„è§ˆé¡µé¢ï¼Œéœ€è¦ç”¨æˆ·è®¤è¯  
- âŒ æ— æ³•ç›´æ¥åµŒå…¥`<img>`æ ‡ç­¾

#### 3. @microsoft.graph.downloadUrl âš ï¸ ä¸´æ—¶ä½¿ç”¨
**æ ¼å¼**: `https://graph.microsoft.com/v1.0/...` (å«ä¸´æ—¶ä»¤ç‰Œ)

**ç‰¹ç‚¹**:
- âœ… æœ€é€‚åˆç›´æ¥åµŒå…¥
- âŒ åŒ…å«ä¸´æ—¶ä»¤ç‰Œï¼Œé€šå¸¸1å°æ—¶åè¿‡æœŸ
- âŒ éœ€è¦å®šæœŸæ›´æ–°é“¾æ¥

#### 4. embed+anonymousåˆ†äº«é“¾æ¥ âŒ ä¼ä¸šè´¦æˆ·ä¸æ”¯æŒ
**æ ¼å¼**: `https://domain/:i:/g/personal/user/EMBED_TOKEN`

**ç‰¹ç‚¹**:
- âœ… æ°¸ä¹…æœ‰æ•ˆ + ç›´æ¥åµŒå…¥
- âŒ ä¼ä¸šMicrosoft 365è´¦æˆ·ä¸æ”¯æŒ
- âœ… ä¸ªäººè´¦æˆ·çš„ç†æƒ³é€‰æ‹©

### å½“å‰æ¨èç­–ç•¥
å¯¹äºä¼ä¸šMicrosoft 365ç¯å¢ƒï¼Œé‡‡ç”¨**SharePointç›´æ¥ä¸‹è½½é“¾æ¥ + æ™ºèƒ½å›é€€**ç­–ç•¥ã€‚

## ğŸš€ è‡ªåŠ¨Headerå›¾ç‰‡åŠŸèƒ½

### åŠŸèƒ½æ¦‚è¿°
ç³»ç»Ÿå¯ä»¥è‡ªåŠ¨ä½¿ç”¨æ­£æ–‡ç¬¬ä¸€å¼ å›¾ç‰‡ä½œä¸ºæ–‡ç« çš„headerå›¾ç‰‡ï¼Œå¹¶è‡ªåŠ¨å¤„ç†æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ ã€‚

### ä½¿ç”¨æ–¹æ³•

#### æ–¹æ³•1: é€šè¿‡run.pyèœå•ï¼ˆæ¨èï¼‰
```bash
python run.py
# é€‰æ‹©ï¼š14. OneDriveå›¾åºŠç®¡ç† â†’ æ™ºèƒ½Header+å›¾ç‰‡å¤„ç†
```

#### æ–¹æ³•2: ç›´æ¥å‘½ä»¤è¡Œ
```bash
# å®Œæ•´å¤„ç†ï¼ˆheader + å›¾ç‰‡ä¸Šä¼ ï¼‰
python scripts/tools/enhanced_blog_image_processor.py "æ–‡ç« è·¯å¾„.md"

# ä»…è®¾ç½®headerï¼ˆä¸ä¸Šä¼ å›¾ç‰‡ï¼‰
python scripts/tools/auto_header_image_processor.py "æ–‡ç« è·¯å¾„.md"

# æ¼”ç»ƒæ¨¡å¼ï¼ˆé¢„è§ˆæ›´æ”¹ï¼‰
python scripts/tools/enhanced_blog_image_processor.py "æ–‡ç« è·¯å¾„.md" --dry-run
```

### æ¨èåˆ›ä½œå·¥ä½œæµç¨‹

1. **åˆ›ä½œé˜¶æ®µ**
   ```markdown
   ---
   title: "æ–‡ç« æ ‡é¢˜"
   date: "2025-08-18"
   categories: ["æŠ€æœ¯èµ‹èƒ½"]
   # headerå­—æ®µå¯ä»¥ç•™ç©ºï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®¾ç½®
   ---
   
   æ–‡ç« å†…å®¹...
   
   ![ç¬¬ä¸€å¼ å›¾ç‰‡](temp/drafting/images/example.png)
   ![å…¶ä»–å›¾ç‰‡](temp/drafting/screenshots/screenshot.png)
   ```

2. **å‘å¸ƒå‰å¤„ç†**
   - è¿è¡Œæ™ºèƒ½Header+å›¾ç‰‡å¤„ç†åŠŸèƒ½
   - ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨ç¬¬ä¸€å¼ å›¾ç‰‡è®¾ç½®header
   - ä¸Šä¼ æ‰€æœ‰å›¾ç‰‡åˆ°OneDriveå¹¶æ›¿æ¢é“¾æ¥

3. **æœ€ç»ˆç»“æœ**
   ```markdown
   ---
   title: "æ–‡ç« æ ‡é¢˜"
   date: "2025-08-18"
   categories: ["æŠ€æœ¯èµ‹èƒ½"]
   header:
     overlay_filter: 0.5
     overlay_image: "https://onedriveé“¾æ¥..."
     teaser: "https://onedriveé“¾æ¥..."
   ---
   
   æ–‡ç« å†…å®¹...
   
   ![ç¬¬ä¸€å¼ å›¾ç‰‡](https://onedriveé“¾æ¥...)
   ![å…¶ä»–å›¾ç‰‡](https://onedriveé“¾æ¥...)
   ```

### æ™ºèƒ½å¤„ç†ç‰¹æ€§

1. **è·¯å¾„æ™ºèƒ½è¯†åˆ«**: æ”¯æŒä¸´æ—¶ç›®å½•ã€ç›¸å¯¹è·¯å¾„ã€Jekyllå˜é‡ç­‰å¤šç§æ ¼å¼
2. **é‡å¤æ£€æŸ¥**: é¿å…é‡å¤ä¸Šä¼ ç›¸åŒå›¾ç‰‡
3. **å¤‡ä»½æœºåˆ¶**: è‡ªåŠ¨å¤‡ä»½åŸæ–‡ä»¶å’Œå›¾ç‰‡
4. **é”™è¯¯æ¢å¤**: å¤„ç†å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š

## ğŸ—ï¸ æ··åˆå›¾ç‰‡ç®¡ç†ç³»ç»Ÿ

### è®¾è®¡ç†å¿µ
å››é˜¶æ®µç®¡ç†æ¨¡å¼ï¼šä¸´æ—¶åˆ›ä½œ â†’ é¡¹ç›®ç¼“å­˜ â†’ äº‘ç«¯å½’æ¡£ â†’ å®‰å…¨æ¸…ç†

### å®Œæ•´ç›®å½•æ¶æ„
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ assets/images/
â”‚   â”œâ”€â”€ processing/              # ä¸´æ—¶å¤„ç†åŒº (gitå¿½ç•¥)
â”‚   â”‚   â”œâ”€â”€ pending/            # å¾…å¤„ç†å›¾ç‰‡
â”‚   â”‚   â”œâ”€â”€ uploaded/           # å·²ä¸Šä¼ å¾…ç¡®è®¤
â”‚   â”‚   â””â”€â”€ failed/             # å¤„ç†å¤±è´¥
â”‚   â””â”€â”€ temp/                   # å…¶ä»–ä¸´æ—¶æ–‡ä»¶
â””â”€â”€ _data/
    â””â”€â”€ onedrive_image_index.json  # äº‘ç«¯ç´¢å¼•è®°å½•
```

### å·¥ä½œæµç¨‹è¯¦è§£

#### é˜¶æ®µ1: åˆ›ä½œæœŸ (ç”¨æˆ·å·¥ä½œåŒº)
- **ä½ç½®**: ä»»æ„ç›®å½• (Desktop, Downloadsç­‰)
- **ç‰¹ç‚¹**: å®Œå…¨çš„åˆ›ä½œè‡ªç”±åº¦

#### é˜¶æ®µ2: å¤„ç†æœŸ (é¡¹ç›®ç¼“å­˜)
- **pending/**: å¾…å¤„ç†å›¾ç‰‡å’Œå…ƒæ•°æ®
- **uploaded/**: å·²ä¸Šä¼ æ–‡ä»¶å’Œé“¾æ¥æ˜ å°„

#### é˜¶æ®µ3: å½’æ¡£æœŸ (äº‘ç«¯å­˜å‚¨)
- **ä½ç½®**: OneDrive `/BlogImages/YYYY/MM/`
- **å‘½å**: `YYYYMMDD_article-slug_NN.ext`

#### é˜¶æ®µ4: æ¸…ç†æœŸ (ç”¨æˆ·ç¡®è®¤)
- **è§¦å‘**: ç”¨æˆ·ç¡®è®¤æ–‡ç« å‘å¸ƒæˆåŠŸ
- **æ“ä½œ**: å®‰å…¨åˆ é™¤æœ¬åœ°å¤‡ä»½æ–‡ä»¶

### å®‰å…¨æœºåˆ¶
- **åŸå§‹æ–‡ä»¶å¤‡ä»½**: å®Œæ•´ä¿å­˜åœ¨uploadedç›®å½•
- **æ“ä½œæ—¥å¿—è®°å½•**: è¯¦ç»†è®°å½•æ‰€æœ‰å¤„ç†æ­¥éª¤
- **å›æ»šæœºåˆ¶**: æ”¯æŒå®Œæ•´æ¢å¤åˆ°å¤„ç†å‰çŠ¶æ€

### ç›‘æ§å’Œç»´æŠ¤
- **è‡ªåŠ¨åŒ–ç»´æŠ¤**: æ¸…ç†è¿‡æœŸæ–‡ä»¶ï¼Œæ£€æŸ¥å¤±è´¥ä¸Šä¼ 
- **å­˜å‚¨ç›‘æ§**: å®šæœŸæŠ¥å‘Šå­˜å‚¨ä½¿ç”¨æƒ…å†µ
- **é“¾æ¥éªŒè¯**: éªŒè¯äº‘ç«¯é“¾æ¥æœ‰æ•ˆæ€§

## åšå®¢åˆ›ä½œå·¥ä½œæµç¨‹

### å®Œæ•´åˆ›ä½œæµç¨‹ (å·²å®ç°å¹¶å¢å¼º)
1. **å†…å®¹åˆ›ä½œ**: ä½¿ç”¨çµæ„Ÿç”Ÿæˆå™¨æˆ–æ‰‹åŠ¨åˆ›å»ºè‰ç¨¿æ–‡ä»¶
2. **å›¾ç‰‡å‡†å¤‡**: æœç´¢/åˆ›ä½œå›¾ç‰‡ï¼Œä¿å­˜åˆ°`assets/images/posts/YYYY/MM/`
3. **å›¾ç‰‡å¼•ç”¨**: åœ¨è‰ç¨¿ä¸­ä½¿ç”¨æœ¬åœ°è·¯å¾„å¼•ç”¨å›¾ç‰‡  
4. **å›¾åºŠå¤„ç†**: æ™ºèƒ½OneDriveå›¾åºŠç®¡ç†æµç¨‹ (2025-08-12 é‡å¤§æ›´æ–°)
   - **åŸºç¡€æµç¨‹**: `run.py` â†’ OneDriveå›¾åºŠç®¡ç† â†’ å¤„ç†å•ä¸ªè‰ç¨¿
   - **å¢å¼ºæµç¨‹**: `enhanced_onedrive_processor.py` â†’ å¸¦å›é€€æœºåˆ¶çš„å®Œæ•´å¤„ç†
   - **Windowsè·¯å¾„æ”¯æŒ**: è‡ªåŠ¨è½¬æ¢Windowsç»å¯¹è·¯å¾„ä¸ºWSLè·¯å¾„
   - **Front Matterå¤„ç†**: æ”¯æŒheader.teaserç­‰å­—æ®µä¸­çš„å›¾ç‰‡è·¯å¾„
   - **æ™ºèƒ½å¤‡ä»½ç­–ç•¥**: 
     * å¤–éƒ¨å›¾ç‰‡è‡ªåŠ¨å¤‡ä»½åˆ°é¡¹ç›®ä¸´æ—¶ç›®å½•
     * æ‰‹åŠ¨åˆ é™¤ç¡®è®¤ï¼Œé¿å…æ„å¤–æ–‡ä»¶ä¸¢å¤±
     * å®Œæ•´çš„å¤‡ä»½ç´¢å¼•è®°å½•
   - **æ°¸ä¹…é“¾æ¥ç”Ÿæˆ**: ä¼˜å…ˆä½¿ç”¨ä¸ä¼šè¿‡æœŸçš„åˆ†äº«é“¾æ¥
   - **å›¾ç‰‡æ¢å¤**: æ”¯æŒä»OneDriveç´¢å¼•å®Œæ•´æ¢å¤å›¾ç‰‡
   - è®°å½•å®Œæ•´ç´¢å¼•åˆ°`_data/onedrive_image_index.json`
5. **æ–‡ç« å‘å¸ƒ**: ç§»åŠ¨åˆ°`_posts/`ç›®å½•ï¼ŒJekyllè‡ªåŠ¨æ„å»º

### å›¾ç‰‡ç®¡ç†å·¥å…·é›† (2025-08-12 æ–°å¢)
- **recover_onedrive_images.py**: OneDriveå›¾ç‰‡æ¢å¤å·¥å…·
  * ä»OneDriveç´¢å¼•æ¢å¤å›¾ç‰‡åˆ°åŸå§‹ç›®å½•
  * ä¿æŒåŸæœ‰æ–‡ä»¶åå’Œç›®å½•ç»“æ„  
  * æ”¯æŒæŒ‰æ–‡ç« æˆ–å…¨é‡æ¢å¤
- **manage_uploaded_images.py**: å·²ä¸Šä¼ å›¾ç‰‡ç®¡ç†å·¥å…·
  * åˆ—å‡ºã€åˆ é™¤ã€æ¸…ç†å·²ä¸Šä¼ çš„å¤‡ä»½æ–‡ä»¶
  * å­˜å‚¨ç»Ÿè®¡å’Œç©ºé—´ç®¡ç†
  * æ‰¹é‡æ“ä½œæ”¯æŒ

### å›é€€å’Œæ¢å¤æœºåˆ¶
- **è‡ªåŠ¨å¿«ç…§**: å¤„ç†å‰è‡ªåŠ¨å¤‡ä»½æ–‡ç« å†…å®¹å’Œæœ¬åœ°å›¾ç‰‡
- **å¤±è´¥å›é€€**: å¤„ç†å¤±è´¥æ—¶è‡ªåŠ¨æ¢å¤åˆ°åŸå§‹çŠ¶æ€
- **æ‰‹åŠ¨æ¢å¤**: å¯ä»ä»»æ„å¿«ç…§IDæ‰‹åŠ¨å›é€€
- **GitHubå¤‡ä»½**: å®Œæ•´çš„æ–‡ç« +å›¾ç‰‡èµ„æºå¤‡ä»½åˆ°GitHub Release
- **ç´¢å¼•æ¢å¤**: åŸºäºOneDriveç´¢å¼•çš„å®Œæ•´å›¾ç‰‡æ¢å¤

## å·¥ä½œæµç¨‹æ¦‚è§ˆ

### å®Œæ•´æµç¨‹å›¾
```
å†…å®¹åˆ›ä½œ â†’ å›¾ç‰‡å‡†å¤‡ â†’ æœ¬åœ°å¼•ç”¨ â†’ OneDriveå¤„ç† â†’ æ–‡ç« å‘å¸ƒ
    â†“         â†“         â†“          â†“          â†“
 è‰ç¨¿æ–‡ä»¶   assetså›¾ç‰‡   MDå¼•ç”¨    äº‘ç«¯æ‰˜ç®¡    _postså‘å¸ƒ
```

## è¯¦ç»†å·¥ä½œæµç¨‹

### 1. å†…å®¹åˆ›ä½œé˜¶æ®µ
**ç›®æ ‡**: åˆ›å»ºå¸¦æœ‰æœ¬åœ°å›¾ç‰‡å¼•ç”¨çš„è‰ç¨¿æ–‡ç« 

**æ“ä½œæ­¥éª¤**:
```bash
# åˆ›å»ºè‰ç¨¿æ–‡ä»¶
_drafts/YYYY-MM-DD-æ–‡ç« æ ‡é¢˜.md
```

**æ–‡ä»¶ç»“æ„ç¤ºä¾‹**:
```markdown
---
title: "æ–‡ç« æ ‡é¢˜"
date: "YYYY-MM-DD"
categories: ["cognitive-upgrade"]
---

æ–‡ç« å†…å®¹...

![å›¾ç‰‡æè¿°](assets/images/posts/2025/08/screenshot.png)
```

### 2. å›¾ç‰‡å‡†å¤‡é˜¶æ®µ
**ç›®æ ‡**: æ”¶é›†å’Œæ•´ç†æ–‡ç« ç›¸å…³å›¾ç‰‡

**ç›®å½•ç»“æ„**:
```
assets/images/posts/
â””â”€â”€ YYYY/
    â””â”€â”€ MM/
        â”œâ”€â”€ image1.png
        â”œâ”€â”€ image2.jpg
        â””â”€â”€ screenshot.png
```

**æ”¯æŒæ ¼å¼**: `.png`, `.jpg`, `.jpeg`, `.gif`, `.webp`, `.svg`

### 3. æœ¬åœ°å¼•ç”¨é˜¶æ®µ
**ç›®æ ‡**: åœ¨è‰ç¨¿ä¸­æ­£ç¡®å¼•ç”¨æœ¬åœ°å›¾ç‰‡

**å¼•ç”¨æ ¼å¼æ”¯æŒ**:
- `assets/images/posts/2025/08/image.png` (ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•)
- `./images/screenshot.png` (ç›¸å¯¹äºæ–‡ç« ç›®å½•)
- `{{ site.baseurl }}/assets/images/posts/2025/08/image.png` (Jekyllå˜é‡)

### 4. OneDriveå¤„ç†é˜¶æ®µ â­
**ç›®æ ‡**: è‡ªåŠ¨åŒ–å›¾ç‰‡ä¸Šä¼ ã€é“¾æ¥æ›¿æ¢ã€æœ¬åœ°æ¸…ç†

#### 4.1 å¯åŠ¨å¤„ç†
```bash
# æ–¹å¼1: é€šè¿‡run.pyèœå•
python run.py
# é€‰æ‹©: 14. OneDriveå›¾åºŠç®¡ç† â†’ 1. å¤„ç†å•ä¸ªè‰ç¨¿æ–‡ä»¶

# æ–¹å¼2: ç›´æ¥å‘½ä»¤è¡Œ
python scripts/tools/onedrive_blog_images.py --draft _drafts/æ–‡ç« å.md
```

#### 4.2 è‡ªåŠ¨åŒ–å¤„ç†æµç¨‹
1. **OAuthè®¤è¯éªŒè¯**
   - æ£€æŸ¥OneDriveè®¿é—®ä»¤ç‰Œæœ‰æ•ˆæ€§
   - å¦‚éœ€è¦ï¼Œè‡ªåŠ¨åˆ·æ–°ä»¤ç‰Œ
   - WSLç¯å¢ƒä¼˜åŒ–: ä½¿ç”¨PowerShellå¯åŠ¨æµè§ˆå™¨

2. **å›¾ç‰‡æ‰«æå’Œè§£æ**
   - æ‰«æè‰ç¨¿æ–‡ä»¶ä¸­çš„å›¾ç‰‡å¼•ç”¨
   - è§£æå„ç§æ ¼å¼çš„æœ¬åœ°è·¯å¾„
   - éªŒè¯å›¾ç‰‡æ–‡ä»¶å®é™…å­˜åœ¨

3. **æ–‡ä»¶å“ˆå¸Œè®¡ç®—**
   - è®¡ç®—æ¯ä¸ªå›¾ç‰‡çš„MD5å“ˆå¸Œå€¼
   - æ£€æŸ¥é‡å¤æ–‡ä»¶ï¼Œé¿å…é‡å¤ä¸Šä¼ 
   - å¦‚å‘ç°é‡å¤ï¼Œç›´æ¥è¿”å›å·²å­˜åœ¨çš„OneDriveé“¾æ¥

4. **OneDriveä¸Šä¼ **
   - åˆ›å»ºç›®æ ‡æ–‡ä»¶å¤¹: `/BlogImages/{year}/{month}/`
   - ä¸Šä¼ æ–‡ä»¶ï¼Œå‘½åæ ¼å¼: `{date}_{article_title}_{index:02d}.{ext}`
   - è·å–OneDriveåˆ†äº«é“¾æ¥å’ŒåµŒå…¥é“¾æ¥

5. **ç´¢å¼•è®°å½•æ›´æ–°**
   - ä¿å­˜å›¾ç‰‡è®°å½•åˆ°`_data/onedrive_image_index.json`
   - è®°å½•å®Œæ•´å…ƒæ•°æ®: è·¯å¾„ã€é“¾æ¥ã€æ–‡ä»¶ä¿¡æ¯ã€æ–‡ç« å…³è”ç­‰

6. **æ–‡ç« é“¾æ¥æ›¿æ¢**
   - å°†æœ¬åœ°å›¾ç‰‡è·¯å¾„æ›¿æ¢ä¸ºOneDriveåµŒå…¥é“¾æ¥
   - æ›´æ–°è‰ç¨¿æ–‡ä»¶å†…å®¹

7. **æœ¬åœ°æ–‡ä»¶æ¸…ç†** (å¯é…ç½®)
   - åˆ é™¤assetsç›®å½•ä¸­å·²æˆåŠŸä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶
   - è‡ªåŠ¨æ¸…ç†ç©ºç›®å½•

#### 4.3 å¤„ç†ç¤ºä¾‹
**å¤„ç†å‰**:
```markdown
![æˆªå›¾](assets/images/posts/2025/08/screenshot.png)
```

**å¤„ç†å**:
```markdown
![æˆªå›¾](https://7fp1fj-my.sharepoint.com/:i:/g/personal/zhurong_7fp1fj_onmicrosoft_com/EQbmqgcFdMxOjQeFxdHciEMB...)
```

**OneDriveç»“æ„**:
```
/BlogImages/
â””â”€â”€ 2025/
    â””â”€â”€ 08/
        â””â”€â”€ 20250811_æ–‡ç« æ ‡é¢˜_01.png
```

**ç´¢å¼•è®°å½•**:
```json
{
  "æ–‡ç« å_01_abc12345": {
    "local_path": "assets/images/posts/2025/08/screenshot.png",
    "onedrive_path": "/BlogImages/2025/08/20250811_æ–‡ç« æ ‡é¢˜_01.png",
    "onedrive_url": "https://...",
    "embed_url": "https://...",
    "article_file": "_drafts/2025-08-11-æ–‡ç« æ ‡é¢˜.md",
    "article_title": "æ–‡ç« æ ‡é¢˜",
    "file_hash": "abc123...",
    "upload_date": "2025-08-11T10:30:00"
  }
}
```

### 5. æ–‡ç« å‘å¸ƒé˜¶æ®µ
**ç›®æ ‡**: å°†å¤„ç†å®Œæˆçš„æ–‡ç« ç§»åŠ¨åˆ°å‘å¸ƒç›®å½•

**æ“ä½œ**:
```bash
# æ‰‹åŠ¨ç§»åŠ¨æ–‡ä»¶
mv _drafts/YYYY-MM-DD-æ ‡é¢˜.md _posts/

# Jekyllè‡ªåŠ¨æ„å»ºå‘å¸ƒ
# æ‰€æœ‰OneDriveé“¾æ¥åœ¨ç”Ÿäº§ç¯å¢ƒæ­£å¸¸æ˜¾ç¤º
```

## å¢å¼ºå·¥å…·ä½¿ç”¨æŒ‡å—

### 1. å¢å¼ºå¤„ç†å™¨ (æ¨è)
```bash
# å¸¦å›é€€å’ŒGitHubå¤‡ä»½çš„å®Œæ•´å¤„ç†
python3 scripts/tools/enhanced_onedrive_processor.py "_drafts/æ–‡ç« .md" --with-github-backup

# ä»å¿«ç…§å›é€€
python3 scripts/tools/enhanced_onedrive_processor.py --rollback "snapshot_id"
```

**ç‰¹æ€§**:
- âœ… è‡ªåŠ¨åˆ›å»ºå¤„ç†å‰å¿«ç…§
- âœ… å¤±è´¥æ—¶è‡ªåŠ¨å›é€€
- âœ… å›¾ç‰‡é“¾æ¥éªŒè¯
- âœ… GitHub Releaseå¤‡ä»½
- âœ… è‡ªåŠ¨ç”Ÿæˆæ¢å¤è„šæœ¬

### 2. é“¾æ¥æ¢å¤å·¥å…·
```bash
# å°†OneDriveé“¾æ¥æ¢å¤ä¸ºæœ¬åœ°Jekyllé“¾æ¥
python3 scripts/tools/restore_local_image_links.py "_drafts/æ–‡ç« .md"

# æ¼”ç»ƒæ¨¡å¼
python3 scripts/tools/restore_local_image_links.py "_drafts/æ–‡ç« .md" --dry-run
```

### 3. å®‰å…¨æ¸…ç†å·¥å…·
```bash
# äº¤äº’å¼æ¸…ç†OneDriveæ–‡ä»¶å’Œè®°å½•
python3 scripts/tools/cleanup_onedrive_images.py --article "_drafts/æ–‡ç« .md"

# æ¸…ç†æ‰€æœ‰è®°å½•
python3 scripts/tools/cleanup_onedrive_images.py
```

## å›¾ç‰‡ç´¢å¼•ç®¡ç†ç³»ç»Ÿ

### ç´¢å¼•æŸ¥è¯¢åŠŸèƒ½
```bash
# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
python scripts/tools/onedrive_image_index.py --stats

# ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
python scripts/tools/onedrive_image_index.py --report

# æŸ¥çœ‹æ–‡ç« ç›¸å…³å›¾ç‰‡
python scripts/tools/onedrive_image_index.py --article _drafts/æ–‡ç« å.md

# æŸ¥çœ‹æ—¥æœŸèŒƒå›´å†…å›¾ç‰‡
python scripts/tools/onedrive_image_index.py --date-range 2025-08-01 2025-08-31

# æ¸…ç†æ— æ•ˆè®°å½•
python scripts/tools/onedrive_image_index.py --cleanup
```

### run.pyé›†æˆèœå•
```
14. OneDriveå›¾åºŠç®¡ç†
    1. å¤„ç†å•ä¸ªè‰ç¨¿æ–‡ä»¶
    2. æ‰¹é‡å¤„ç†è‰ç¨¿ç›®å½•  
    3. è®¾ç½®OneDriveè®¤è¯
    4. æµ‹è¯•OneDriveè¿æ¥
    5. æŸ¥çœ‹é…ç½®ä¿¡æ¯
    6. å›¾ç‰‡ç´¢å¼•ç®¡ç† â† æ–°å¢åŠŸèƒ½
        1. æŸ¥çœ‹å›¾ç‰‡ç»Ÿè®¡
        2. ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
        3. æŒ‰æ–‡ç« æŸ¥è¯¢å›¾ç‰‡
        4. æ¸…ç†æ— æ•ˆè®°å½•
        5. æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

## OneDriveè´¦æˆ·ç±»å‹è¯´æ˜

### ä¼ä¸šè´¦æˆ· vs ä¸ªäººè´¦æˆ·

**ä¼ä¸šMicrosoft 365è´¦æˆ·** (å½“å‰ä½¿ç”¨):
- âœ… æ”¯æŒ `view+anonymous` åˆ†äº«æ¨¡å¼
- âŒ **ä¸æ”¯æŒ** `embed+anonymous` åˆ†äº«æ¨¡å¼ 
- âœ… ä¼ä¸šçº§ç®¡ç†å’Œå®‰å…¨æ§åˆ¶
- âœ… æ›´å¤§å­˜å‚¨ç©ºé—´
- ğŸ”— åˆ†äº«é“¾æ¥æ ¼å¼: `https://xxx.sharepoint.com/:i:/g/personal/...`

**ä¸ªäººOneDriveè´¦æˆ·**:
- âœ… æ”¯æŒ `view+anonymous` åˆ†äº«æ¨¡å¼
- âœ… æ”¯æŒ `embed+anonymous` åˆ†äº«æ¨¡å¼
- ğŸ”— åˆ†äº«é“¾æ¥æ ¼å¼: `https://onedrive.live.com/...`

### é…ç½®å»ºè®®

**ä¼ä¸šè´¦æˆ·é…ç½®** (æ¨è):
```json
{
  "links": {
    "type": "view",
    "scope": "anonymous",
    "width": 800
  }
}
```

**ä¸ªäººè´¦æˆ·é…ç½®**:
```json
{
  "links": {
    "type": "embed",
    "scope": "anonymous", 
    "width": 800
  }
}
```

## é…ç½®ç®¡ç†

### æ ¸å¿ƒé…ç½®æ–‡ä»¶: `config/onedrive_config.json`
```json
{
  "auth": {
    "tenant_id": "YOUR_TENANT_ID",
    "client_id": "YOUR_CLIENT_ID", 
    "client_secret": "YOUR_CLIENT_SECRET",
    "redirect_uri": "http://localhost:8080/callback",
    "scopes": ["Files.ReadWrite", "offline_access"]
  },
  "onedrive": {
    "base_folder": "/BlogImages",
    "folder_structure": "{year}/{month:02d}",
    "filename_format": "{date}_{article_title}_{index:02d}.{ext}"
  },
  "processing": {
    "max_file_size_mb": 32,
    "delete_local_after_upload": true,
    "backup_before_delete": false
  },
  "links": {
    "type": "view",
    "scope": "anonymous",
    "width": 800,
    "height": null,
    "quality": "auto"
  }
}
```

### ç¯å¢ƒå˜é‡é…ç½®: `.env`
```bash
# OneDriveè®¤è¯ä¿¡æ¯ (æ•æ„Ÿæ•°æ®)
ONEDRIVE_TENANT_ID=actual_tenant_id
ONEDRIVE_CLIENT_ID=actual_client_id
ONEDRIVE_CLIENT_SECRET=actual_client_secret
ONEDRIVE_REDIRECT_URI=http://localhost:8080/callback
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### 1. OAuthè®¤è¯å¤±è´¥
**ç—‡çŠ¶**: æµè§ˆå™¨æ˜¾ç¤º"missing scope parameter"
**è§£å†³**: 
- æ£€æŸ¥Azureåº”ç”¨æƒé™é…ç½®
- ç¡®è®¤ç¯å¢ƒå˜é‡æ­£ç¡®è®¾ç½®
- WSLç¯å¢ƒä½¿ç”¨PowerShellå¯åŠ¨æµè§ˆå™¨

#### 2. è·¯å¾„è§£æå¤±è´¥
**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º"Could not resolve local path"
**è§£å†³**:
- æ£€æŸ¥å›¾ç‰‡æ–‡ä»¶æ˜¯å¦å®é™…å­˜åœ¨
- ç¡®è®¤è·¯å¾„æ ¼å¼æ­£ç¡®
- æ”¯æŒçš„æ ¼å¼: ç›¸å¯¹è·¯å¾„ã€Jekyllå˜é‡ã€ç»å¯¹è·¯å¾„

#### 3. ä¸Šä¼ å¤±è´¥
**ç—‡çŠ¶**: ä¸Šä¼ è¿‡ç¨‹ä¸­æŠ¥é”™
**è§£å†³**:
- æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶ (é»˜è®¤32MB)
- éªŒè¯OneDriveå­˜å‚¨ç©ºé—´
- ç¡®è®¤ç½‘ç»œè¿æ¥ç¨³å®š

#### 4. ç´¢å¼•è®°å½•ä¸ä¸€è‡´
**ç—‡çŠ¶**: ç´¢å¼•æ˜¾ç¤ºçš„å›¾ç‰‡ä¸å®é™…ä¸ç¬¦
**è§£å†³**:
```bash
# æ¸…ç†æ— æ•ˆè®°å½•
python scripts/tools/onedrive_image_index.py --cleanup
```

#### 5. å›¾ç‰‡é“¾æ¥403é”™è¯¯
**ç—‡çŠ¶**: OneDriveå›¾ç‰‡é“¾æ¥è¿”å›"403 Forbidden"é”™è¯¯
**åŸå› **: ä¼ä¸šè´¦æˆ·ä¸æ”¯æŒembed+anonymousæ¨¡å¼
**è§£å†³**:
1. æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„links.typeè®¾ç½®
2. ä¼ä¸šè´¦æˆ·ä½¿ç”¨`"type": "view"`
3. ä¸ªäººè´¦æˆ·å¯ä½¿ç”¨`"type": "embed"`
```json
{
  "links": {
    "type": "view",       // ä¼ä¸šè´¦æˆ·å¿…é¡»ä½¿ç”¨view
    "scope": "anonymous"  // åŒ¿åè®¿é—®
  }
}
```

## æœ€ä½³å®è·µ

### 1. æ–‡ä»¶å‘½åè§„èŒƒ
- å›¾ç‰‡æ–‡ä»¶ä½¿ç”¨è‹±æ–‡åç§°ï¼Œé¿å…ç‰¹æ®Šå­—ç¬¦
- é‡‡ç”¨æè¿°æ€§å‘½å: `wechat-interface.png`, `data-analysis-chart.jpg`

### 2. æ–‡ä»¶å¤§å°æ§åˆ¶
- å•ä¸ªå›¾ç‰‡æ–‡ä»¶ä¸è¶…è¿‡32MB
- å»ºè®®å‹ç¼©å¤§å›¾ç‰‡ä»¥æé«˜ä¸Šä¼ é€Ÿåº¦

### 3. æ‰¹é‡å¤„ç†å»ºè®®
- å¯¹äºå¤šç¯‡æ–‡ç« ï¼Œå¯ä»¥ä½¿ç”¨æ‰¹é‡å¤„ç†åŠŸèƒ½
- å»ºè®®åœ¨ç½‘ç»œç¨³å®šæ—¶è¿›è¡Œæ‰¹é‡æ“ä½œ

### 4. å¤‡ä»½ç­–ç•¥
- é‡è¦å›¾ç‰‡å»ºè®®ä¿ç•™æœ¬åœ°å¤‡ä»½
- å¯é…ç½®`backup_before_delete: true`ä¿ç•™åŸæ–‡ä»¶

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-08-11  
**ç»´æŠ¤**: ä¸OneDriveç³»ç»ŸåŠŸèƒ½å˜æ›´åŒæ­¥æ›´æ–°